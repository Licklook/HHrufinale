<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сервис генерации карты процесса</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0e1621;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #chat-header {
            background-color: #17212b;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #242f3d;
        }
        #chat-header .avatar {
            width: 40px;
            height: 40px;
            background-color: #9146ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            margin-right: 10px;
        }
        #chat-header .name {
            font-size: 18px;
            font-weight: bold;
        }
        #chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        #chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        #chat-input {
            display: flex;
            padding: 10px;
            background-color: #17212b;
            border-top: 1px solid #242f3d;
        }
        #chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            background-color: #242f3d;
            color: #ffffff;
            margin-right: 10px;
            font-size: 16px;
        }
        #chat-input button {
            background-color: #248bf5;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
        }
        #chat-input button:hover {
            background-color: #1c74d4;
        }
        .message {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-end;
        }
        .user-message {
            justify-content: flex-end;
        }
        .user-message .bubble {
            background-color: #248bf5;
            color: white;
            padding: 10px 15px;
            border-radius: 18px 18px 0 18px;
            max-width: 70%;
            font-size: 16px;
        }
        .assistant-message {
            justify-content: flex-start;
        }
        .assistant-message .avatar {
            width: 32px;
            height: 32px;
            background-color: #9146ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
        }
        .assistant-message .content {
            display: flex;
            flex-direction: column;
        }
        .assistant-message .bubble {
            background-color: #242f3d;
            color: #ffffff;
            padding: 10px 15px;
            border-radius: 18px 18px 18px 0;
            max-width: 70%;
            font-size: 16px;
        }
        .time {
            font-size: 12px;
            color: #7f8c9a;
            margin-top: 2px;
            padding: 0 15px;
        }
        .user-message .time {
            text-align: right;
        }
        /* Initial greeting styles */
        #initial-greeting {
            text-align: center;
            margin-top: 50vh;
            transform: translateY(-50%);
            transition: all 1s ease;
        }
        #initial-greeting .avatar {
            width: 80px;
            height: 80px;
            font-size: 40px;
            margin: 0 auto 10px;
        }
        #initial-greeting .bubble {
            font-size: 20px;
            padding: 15px 20px;
            border-radius: 20px;
            display: inline-block;
        }
        #initial-greeting.transforming {
            transform: translateY(100%) scale(0.5);
            opacity: 0;
        }
        .assistant-message.standard .bubble {
            border-radius: 18px 18px 18px 0;
        }
        /* Scrollbar styles */
        #chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        #chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        #chat-messages::-webkit-scrollbar-thumb {
            background: #3a4759;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div id="chat-header">
        <div class="avatar">V</div>
        <div class="name">VibeMan</div>
    </div>
    <div id="chat-section">
        <div id="chat-messages"></div>
        <div id="chat-input">
            <input type="text" id="query" placeholder="Сообщение...">
            <button onclick="sendMessage()">Отправить</button>
        </div>
    </div>

    <script>
        let userQuery = '';
        let userAnswers = [];
        let state = 'query'; // 'query', 'questions', 'result'
        let questions = [
            'Какой у вас уровень опыта? (junior, mid, senior)',
            'Специфика компании? (IT, finance, etc.)',
            'Дополнительные детали о процессе?'
        ];

        // Инициализация чата с приветствием
        function initializeChat() {
            const messages = document.getElementById('chat-messages');
            messages.innerHTML = `
                <div id="initial-greeting" class="assistant-message">
                    <div class="avatar">V</div>
                    <div class="bubble">Привет!</div>
                </div>
            `;
        }

        initializeChat();

        function getCurrentTime() {
            const now = new Date();
            return now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
        }

        async function sendMessage() {
            const input = document.getElementById('query');
            const text = input.value.trim();
            if (!text) return;

            const messages = document.getElementById('chat-messages');

            // Анимация трансформации приветствия
            const initial = document.getElementById('initial-greeting');
            if (initial && state === 'query') {
                initial.classList.add('transforming');
                setTimeout(() => {
                    initial.remove();
                    appendAssistantMessage('Привет!', true);
                }, 1000);
            }

            // Добавляем сообщение пользователя
            messages.innerHTML += `
                <div class="message user-message">
                    <div class="bubble">${text}</div>
                </div>
                <div class="time">${getCurrentTime()}</div>
            `;
            input.value = '';
            messages.scrollTop = messages.scrollHeight;

            // Обработка в зависимости от состояния
            if (state === 'query') {
                userQuery = text;
                askQuestions();
            } else if (state === 'questions') {
                userAnswers.push(text);
                if (userAnswers.length < questions.length) {
                    appendAssistantMessage(questions[userAnswers.length]);
                } else {
                    state = 'result';
                    generateProcessMap();
                }
            }
        }

        function askQuestions() {
            state = 'questions';
            appendAssistantMessage(questions[0]);
        }

        function appendAssistantMessage(content, isStandard = false) {
            const messages = document.getElementById('chat-messages');
            messages.innerHTML += `
                <div class="message assistant-message ${isStandard ? 'standard' : ''}">
                    <div class="avatar">V</div>
                    <div class="content">
                        <div class="bubble">${content}</div>
                    </div>
                </div>
                <div class="time">${getCurrentTime()}</div>
            `;
            messages.scrollTop = messages.scrollHeight;
        }

        async function generateProcessMap() {
            // Определяем профессию и уровень
            const profession = userQuery.includes('DevOps') ? 'DevOps' : 'Разработчик';
            const experience = userAnswers[0].toLowerCase();

            // Данные для карты (мок)
            const data = {
                dailyRoutine: '<h3>Распорядок типичного рабочего дня</h3><p>9:00 - Стендап-митинг<br>10:00 - Работа над задачами по автоматизации<br>12:00 - Обед<br>13:00 - Мониторинг систем<br>17:00 - Ревью кода и планирование</p>',
                techStack: '<h3>Стек технологий и инструментов</h3><p>Docker, Kubernetes, Jenkins, Terraform, AWS, Git, Prometheus</p>',
                companyProcess: '<h3>Процесс для компании</h3><p>План действий: Оптимизировать CI/CD пайплайн для сокращения времени деплоя на 30% путем внедрения параллельного тестирования и кэширования артефактов.</p>',
                careerPath: '<h3>Путь роста</h3><p>Junior DevOps: Освоение базовых инструментов → Mid DevOps: Автоматизация процессов → Senior DevOps: Архитектура систем и лидерство команды.</p>',
                growth: '<h3>Неограниченные возможности роста</h3><p>Переход в роли DevOps Architect, Cloud Engineer или даже CTO. Возможности фриланса, международные проекты и сертификации (AWS Certified DevOps Engineer, etc.).</p>',
                promising: '<h3>Насколько перспективное направление?</h3><p>Очень перспективное: Рост рынка DevOps на 20% ежегодно. Количество вакансий в России ~5000 (по данным HH.ru). Конкурентность средняя - требуется опыт, но спрос высокий.</p>',
                keyElements: '<h3>Основные звенья</h3><p>Языки программирования: Python, Bash; Используемые сообществом: GitHub, Stack Overflow; Run services: CI/CD pipelines; Другие аспекты: Мониторинг, безопасность, scaling.</p>',
                visual: '<h3>Визуал (мудборд)</h3><img src="https://via.placeholder.com/600x400?text=Скриншот+кода+DevOps" alt="Скриншот кода"><img src="https://via.placeholder.com/600x400?text=Дашборд+Kubernetes" alt="Дашборд"><img src="https://via.placeholder.com/600x400?text=Рабочее+место+DevOps" alt="Рабочее место">'
            };

            let salariesHtml = `<h3>Примерные зарплаты (${experience})</h3>`;
            let fallbackSalaries = {
                junior: '100 000 - 150 000 руб/мес',
                mid: '200 000 - 300 000 руб/мес',
                senior: '300 000+ руб/мес'
            };
            salariesHtml += `<p>${fallbackSalaries[experience] || 'Не указан уровень'}</p>`;

            // Собираем весь контент карты
            const mapContent = `
                ${data.dailyRoutine}
                ${data.techStack}
                ${data.companyProcess}
                ${data.careerPath}
                ${salariesHtml}
                ${data.growth}
                ${data.promising}
                ${data.keyElements}
                ${data.visual}
            `;

            appendAssistantMessage(mapContent);
        }
    </script>
</body>
</html>